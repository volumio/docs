<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Rotary Encoder II - Volumio Documentation</title>
    <meta name="description" content="The Audiophile Music Player" />
    <meta name="author" content="Michelangelo Guarise">
    <meta charset="UTF-8">
    <link rel="icon" href="../../themes/daux/img/favicon.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../../themes/daux/css/theme.min.css' rel='stylesheet' type='text/css'><link href='../../themes/daux/css/volumiodocs.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<div class="container-fluid fluid-height wrapper">
    <div class="navbar navbar-static-top hidden-print">
        <div class="container-fluid">
            <a class="brand navbar-brand pull-left" href="../../index.html">Volumio Documentation</a>

    <div class="navbar-right navbar-form search">
        <i class="glyphicon glyphicon-search search__icon">&nbsp;</i>
        <input type="search" id="tipue_search_input" class="form-control search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
        </div>
    </div>
    <div class="row columns content">
        <div class="left-column article-tree col-sm-3 hidden-print">
            <!-- For Mobile -->
            <div class="responsive-collapse">
                <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="sub-nav-collapse" class="sub-nav-collapse">
                <!-- Navigation -->
                <ul class='nav nav-list'><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>User Manual</a><ul class='nav nav-list'><li class=''><a href="../../User_Manual/Quick_Start_Guide.html">Quick Start Guide</a></li><li class=''><a href="../../User_Manual/First_steps_with_Volumio.html">First steps with Volumio</a></li><li class=''><a href="../../User_Manual/More_first_steps.html">More first steps</a></li><li class=''><a href="../../User_Manual/System_updates.html">System updates</a></li><li class=''><a href="../../User_Manual/Volume_Control_and_audio_quality.html">Volume Control and audio quality</a></li><li class=''><a href="../../User_Manual/Stream_audio_to_volumio.html">Stream audio to volumio</a></li><li class=''><a href="../../User_Manual/SSH.html">SSH</a></li><li class=''><a href="../../User_Manual/Configure_MPD_Clients_for_albumart.html">Configure MPD Clients for albumart</a></li><li class=''><a href="../../User_Manual/Sending_logs_for_troubleshooting.html">Sending logs for troubleshooting</a></li><li class=''><a href="../../User_Manual/Other_Customizations.html">Other Customizations</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Development How To</a><ul class='nav nav-list'><li class=''><a href="../../Development_How_To/Overview.html">Overview</a></li><li class=''><a href="../../Development_How_To/System_Architecture.html">System Architecture</a></li><li class=''><a href="../../Development_How_To/Set_up_development_environment_introduction.html">Set up development environment introduction</a></li><li class=''><a href="../../Development_How_To/Set_up_development_environment_for_backend.html">Set up development environment for backend</a></li><li class=''><a href="../../Development_How_To/Set_up_development_environment_for_UI.html">Set up development environment for UI</a></li><li class=''><a href="../../Development_How_To/Set_up_development_environment_for_Volumio_images.html">Set up development environment for Volumio images</a></li><li class=''><a href="../../Development_How_To/Updating_source_files.html">Updating source files</a></li><li class=''><a href="../../Development_How_To/Debugging.html">Debugging</a></li><li class=''><a href="../../Development_How_To/Helping_the_project.html">Helping the project</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>API</a><ul class='nav nav-list'><li class=''><a href="../../API/API_Overview.html">API Overview</a></li><li class=''><a href="../../API/WebSocket_APIs.html">WebSocket APIs</a></li><li class=''><a href="../../API/UI_Configuration_Pages.html">UI Configuration Pages</a></li><li class=''><a href="../../API/REST_API.html">REST API</a></li><li class=''><a href="../../API/Command_Line_Client.html">Command Line Client</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Plugin System</a><ul class='nav nav-list'><li class=''><a href="../../Plugin_System/Plugin_System_Overview.html">Plugin System Overview</a></li><li class=''><a href="../../Plugin_System/Writing_A_Plugin.html">Writing A Plugin</a></li><li class=''><a href="../../Plugin_System/Index.js.html">Index.js</a></li><li class=''><a href="../../Plugin_System/UI_Configuration_Pages.html">UI Configuration Pages</a></li><li class=''><a href="../../Plugin_System/Toast_Messages.html">Toast Messages</a></li><li class=''><a href="../../Plugin_System/Logging.html">Logging</a></li><li class=''><a href="../../Plugin_System/User_Modal.html">User Modal</a></li><li class=''><a href="../../Plugin_System/Music_Service_Plugin.html">Music Service Plugin</a></li><li class=''><a href="../../Plugin_System/Custom_ALSA_Contributions.html">Custom ALSA Contributions</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>I2S DACs</a><ul class='nav nav-list'><li class=''><a href="../../I2S_DACs/Adding_Compatibility_to_your_DAC.html">Adding Compatibility to your DAC</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Porting Guide</a><ul class='nav nav-list'><li class=''><a href="../../Porting_Guide/Introduction.html">Introduction</a></li><li class=''><a href="../../Porting_Guide/What_Is_Needed_To_Port_Successfully.html">What Is Needed To Port Successfully</a></li><li class=''><a href="../../Porting_Guide/Preparing_The_Build_Environment.html">Preparing The Build Environment</a></li><li class=''><a href="../../Porting_Guide/The_Process.html">The Process</a></li><li class=''><a href="../../Porting_Guide/The_Platform_Folder.html">The Platform Folder</a></li><li class=''><a href="../../Porting_Guide/Compiling_U-Boot.html">Compiling U-Boot</a></li><li class=''><a href="../../Porting_Guide/Get_The_Kernel_Source.html">Get The Kernel Source</a></li><li class=''><a href="../../Porting_Guide/Configure_Kernel_Options.html">Configure Kernel Options</a></li><li class=''><a href="../../Porting_Guide/Compiling_The_Kernel.html">Compiling The Kernel</a></li><li class=''><a href="../../Porting_Guide/Boot_Parameters.html">Boot Parameters</a></li><li class=''><a href="../../Porting_Guide/Saving_Files_To_The_Platform_Folder.html">Saving Files To The Platform Folder</a></li><li class=''><a href="../../Porting_Guide/A_Complete_Script.html">A Complete Script</a></li><li class=''><a href="../../Porting_Guide/1_How_To_Build_A_Sparky.html">1 How To Build A Sparky</a></li><li class=''><a href="../../Porting_Guide/Creating_the_image.html">Creating the image</a></li><li class=''><a href="../../Porting_Guide/Creating_the_image_build_scripts (Part 1).html">Creating the image build scripts (Part 1)</a></li><li class=''><a href="../../Porting_Guide/Creating_the_image_build_scripts (Part 2).html">Creating the image build scripts (Part 2)</a></li></ul></li><li class='open has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Plugins User Manuals</a><ul class='nav nav-list'><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>brutefir</a><ul class='nav nav-list'><li class=''><a href="../../Plugins_User_Manuals/brutefir/Drc_with_Volumio.html">Drc with Volumio</a></li><li class=''><a href="../../Plugins_User_Manuals/brutefir/Preparing_your_system.html">Preparing your system</a></li><li class=''><a href="../../Plugins_User_Manuals/brutefir/Making_Measurment.html">Making Measurment</a></li><li class=''><a href="../../Plugins_User_Manuals/brutefir/Making_filters.html">Making filters</a></li><li class=''><a href="../../Plugins_User_Manuals/brutefir/Using_filters_in_Volumio.html">Using filters in Volumio</a></li></ul></li><li class='open has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>rotaryencoder2</a><ul class='nav nav-list'><li class='active'><a href="../../Plugins_User_Manuals/rotaryencoder2/Rotary_Encoder_II.html">Rotary Encoder II</a></li><li class=''><a href="../../Plugins_User_Manuals/rotaryencoder2/Debouncing.html">Debouncing</a></li><li class=''><a href="../../Plugins_User_Manuals/rotaryencoder2/Device_Tree_Overlays.html">Device Tree Overlays</a></li><li class=''><a href="../../Plugins_User_Manuals/rotaryencoder2/Compatible_Encoders.html">Compatible Encoders</a></li><li class=''><a href="../../Plugins_User_Manuals/rotaryencoder2/Appendix.html">Appendix</a></li></ul></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Good to Knows</a><ul class='nav nav-list'><li class=''><a href="../../Good_to_Knows/Markdown_Cheatsheet.html">Markdown Cheatsheet</a></li><li class=''><a href="../../Good_to_Knows/Mounting_an_NFS_Share.html">Mounting an NFS Share</a></li><li class=''><a href="../../Good_to_Knows/Contribute_to_this_Doc.html">Contribute to this Doc</a></li><li class=''><a href="../../Good_to_Knows/Connection_Outside_LAN.html">Connection Outside LAN</a></li><li class=''><a href="../../Good_to_Knows/Finding_Volumio.html">Finding Volumio</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>FAQs</a><ul class='nav nav-list'><li class=''><a href="../../FAQs/General.html">General</a></li><li class=''><a href="../../FAQs/Installation.html">Installation</a></li><li class=''><a href="../../FAQs/Updating_and_Maintenance.html">Updating and Maintenance</a></li><li class=''><a href="../../FAQs/Audio_Sources.html">Audio Sources</a></li><li class=''><a href="../../FAQs/Audio_Output.html">Audio Output</a></li></ul></li></ul>

                <div class="sidebar-links">
                    
                        <!-- Links -->
                        <a href="https://volumio.org" target="_blank">Home</a><br><a href="https://volumio.org/get-started" target="_blank">Download</a><br><a href="https://volumio.org/forum" target="_blank">Forum</a><br><a href="https://github.com/volumio" target="_blank">GitHub Repo</a><br><a href="https://volumio.github.io/docs/Good_to_Knows/Contribute_to_this_Doc.html" target="_blank">Improve this documentation</a><br>
                        <div id="toggleCodeBlock">
                                                    <a id="toggleCodeBlockBtn" href="#" onclick="toggleCodeBlocks();">Show Code Blocks Inline</a><br>
                                                </div>

                        <!-- Twitter -->
                                                    <div class="twitter">
                                <hr/>
                                <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=volumio&amp;show_count=false"></iframe>
                            </div>
                        
                        <hr/>
                    
                </div>
            </div>
        </div>
        <div class="right-column  content-area col-sm-9">

            <div class="content-page">
                                    <div id="tipue_search_content" style="display:none"></div>
                
                <div class="doc_content">
                    <article>
            <div class="page-header">
            <h1>Rotary Encoder II</h1>
        </div>
    
    <h1 id="page_Rotary_Encoder_II_Plugin">Rotary Encoder II Plugin</h1>
<p><strong><em>by 7h0mas-R</em></strong></p>
<p>This is an alternative implementation of a rotary encoder driver for integration with Volumio. It dynamically loads device tree overlays to access the rotaries and is more responsive with the tested encoders than the existing plugin.</p>
<h2 id="page_Configuring_the_Plugin">Configuring the Plugin</h2>
<p>The plugin currently supports up to three encoders. The code is implemented in such a way, that this can quite easily be expanded - feel free to create a branch and do it.<br />
After installing the plugin, each encoder can be individually enabled in the settings.</p>
<p><img src="./img/settings_en.jpg" alt="Plugin Settings for one Rotary Encoder" /><br />
<strong>Img 1:</strong> <em>Settings for one of the encoders</em></p>
<p>After enabling an encoder, the following parameters can be set:</p>
<h3 id="page_Periods_per_step">Periods per step</h3>
<p>There are different encoder types in the market. Many of them have a ratchet mechanism, so you can feel 'click' positions when you turn the knob.<br />
There are three different implementations in the DT overlay driver:</p>
<p><strong><em>1/1: Full period per step</em></strong><br />
From one tick to the next, both switches of the encoder perform a full cycle <em>on - off - on</em> (or vice versa).</p>
<p><strong><em>1/2: Half period per step</em></strong><br />
From one tick to the next, both switches of the encoder perform half a cycle <em>on - off</em> (or vice versa)</p>
<p><strong><em>1/4: Quarter period per step</em></strong><br />
From one tick to the next, only one of both switches of the encoder changes state. The other switch will change state with the next click in the same direction.</p>
<p>If you are uncertain about your type, check the manufacturers datasheet or use a multimeter to measure the situation in your rotary.</p>
<p><img src="./img/rotary_types.jpg" alt="Supported rotary types" /><br />
<strong>Img 2:</strong> <em>Switching characteristic of different rotary types supported.</em></p>
<h3 id="page_Pin_A_GPIO_Pin_B_GPIO">Pin A GPIO/ Pin B GPIO</h3>
<p>The GPIO pins that are connected to the A and B channels of your encoder.</p>
<h3 id="page_Dial_Function">Dial Function</h3>
<p>Pick the functionality you would like for your encoder:</p>
<ul>
<li>Volume down/up</li>
<li>Skip previous/next</li>
<li>Seek backwards/forward</li>
<li>Emit websocket message<br>
</li>
</ul>
<p>The Emit function opens four additional text boxes for providing the websocket commands and data for clockwise (CW) and counter-clockwise (CCW) turns. It allows, to provide commands to a websock emitter and can be used to trigger other functions inside other plugins. For example, if you have a Plugin controlling a Dimmer with a function <code>dim</code> taking an argument <code>'up'</code> or <code>'down'</code> you would need to put 'dim' into both command fields and 'up' or 'down' into the respective data field.
You could also send Volumio Volume or Skip functions via this option (just to give you an idea):<br />
<strong>Volume</strong>:</p>
<ul>
<li>Command CW: 'volume'</li>
<li>Command CCW: 'volume'</li>
<li>Data CW: '+'</li>
<li>Data CCW: '-'</li>
</ul>
<p><strong>Skip</strong>:</p>
<ul>
<li>Command CW: 'prev'</li>
<li>Command CCW: 'next'</li>
<li>Data CW: '' (empty, <em>prev</em> takes no argument)</li>
<li>Data CCW: '' (empty, <em>next</em> takes no argument)</li>
</ul>
<p><strong>WARNING:</strong><br />
If you use the <em>Emit</em> function, remember that a fast turn of the knob can send a lot of messages in short time, so the called function better be fast or prepared for 'flooding'.<br />
To assure fault-free operation is your responsibility in this case.</p>
<h3 id="page_Button_GPIO">Button GPIO</h3>
<p>GPIO pin of your device that is connected to the encoder push button.</p>
<h3 id="page_Debounce_Time">Debounce Time</h3>
<p>If you do not have hardware debouncing for your push button, you can set a software debouncing time here. The unit is milliseconds, try values below 100ms, everything higher may generate poor user-experience.</p>
<h3 id="page_Button_Logic_Level_Active_Low">Button Logic-Level Active Low</h3>
<p>By default the plugin assumes, that your GPIOs are pulled low and that the GPIO will become logical high, when you push the button. If your hardware works the other way round and your button pulls the GPIO low when pressed, you have to activate this switch.</p>
<h3 id="page_Short_Press_Action_Long_Press_action">Short Press Action/ Long Press action</h3>
<p>Various functionalities that can be associated with the push button. For compatibility I have added most functions that the initial <em>Rotary Encoder Plugin</em> supports. Additionally there is a an Emit Function equivalent to the one available for the rotation. You find more information there.<br />
Long press action is executed if the button is pushed for longer than 1.5 seconds.<br />
Available Commands:</p>
<ul>
<li>Play</li>
<li>Pause</li>
<li>Play/Pause toggle</li>
<li>Stop</li>
<li>Repeat</li>
<li>Random</li>
<li>Clear Queue</li>
<li>Mute</li>
<li>Unmute</li>
<li>Toggle Mute</li>
<li>System Shutdown</li>
<li>System Reboot</li>
<li>Emit websocket message</li>
</ul>
<h2 id="page_Differences_compared_to_Rotary_Encoder_Plugin">Differences compared to <em>Rotary Encoder Plugin</em></h2>
<p>The initial rotary encoder plugin by <em>Saiyato</em> is built based on npm OnOff library and a derived onoff-rotary to read the GPIO pins of the Linux system (e.g. Raspberry Pi) and the implementation of the Gray-Code is tailored to the use of the KY040 encoder.<br />
With my custom made hardware using three <em>ALPS STEC11B03</em> encoders, it worked but the response was not really satisfactory because the plugin would only respond on every second 'tick' of the encoder and would sometimes misinterpret the direction.<br />
I tried to improve it with hardware debouncing (see <a href="./01_Debouncing.md#tips-for-debouncing-your-encoder">here</a> for tips) and by optimizing the implementation but the result was not satisfactory.<br />
I finally wrote my own implementation based on DT overlay driven rotary encoders giving me perfect results. Since the hardware debouncing is in my hardware anyway now, I did not bother to try the plugin without the Schmitt-Trigger - I guess that it would work without it, too. Feel free to leave a note, if you can confirm this.<br />
I first thought about implementing my solution into the existing plugin, but finally decided against it due to lack of time and because is rather an alternative than an extension.<br />
If your system does not support DT overlays or you run into other issues, the other plugin may still be your first choice.
Feel free to try both Plugins and pick the one, that suits your application best.<br />
If this Plugin works for you and you use a new type of encoder, it would be nice if you add your model to the list of supported devices below, so others can pick one that is working.<br />
If you should observe problems, you may create an issue, but I have very limited time to look into that. I rely on enthusiasts to dig into the limitations of the plugin - the debug function in the settings is very chatty, so it should help to get to the issue fast.</p>

        <nav>
        <ul class="pager">
            <li><a href="../../Plugins_User_Manuals/brutefir/Using_filters_in_Volumio.html">Previous</a></li>            <li><a href="../../Plugins_User_Manuals/rotaryencoder2/Debouncing.html">Next</a></li>        </ul>
    </nav>
    </article>

                </div>
            </div>
        </div>
    </div>
</div>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46374275-1', '');
    ga('send', 'pageview');
</script>

    <!-- jQuery -->
    <script src="../../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../../tipuesearch/tipuesearch_set.js"></script>
        <script type="text/javascript" src="../../tipuesearch/tipuesearch.min.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(document).ready(function() {
                $('#tipue_search_input').tipuesearch({
                    'show': 10,
                    'mode': 'json',
                    'base_url': '../../'
                });
            });
        </script>
    
</body>
</html>
