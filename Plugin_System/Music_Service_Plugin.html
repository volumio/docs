<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Music Service Plugin - Volumio Documentation</title>
    <meta name="description" content="The Audiophile Music Player" />
    <meta name="author" content="Michelangelo Guarise">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme.min.css' rel='stylesheet' type='text/css'><link href='../themes/daux/css/volumiodocs.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<div class="container-fluid fluid-height wrapper">
    <div class="navbar navbar-static-top hidden-print">
        <div class="container-fluid">
            <a class="brand navbar-brand pull-left" href="../index.html">Volumio Documentation</a>

    <div class="navbar-right navbar-form search">
        <i class="glyphicon glyphicon-search search__icon">&nbsp;</i>
        <input type="search" id="tipue_search_input" class="form-control search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
        </div>
    </div>
    <div class="row columns content">
        <div class="left-column article-tree col-sm-3 hidden-print">
            <!-- For Mobile -->
            <div class="responsive-collapse">
                <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="sub-nav-collapse" class="sub-nav-collapse">
                <!-- Navigation -->
                <ul class='nav nav-list'><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>User Manual</a><ul class='nav nav-list'><li class=''><a href="../User_Manual/Quick_Start_Guide.html">Quick Start Guide</a></li><li class=''><a href="../User_Manual/First_steps_with_Volumio.html">First steps with Volumio</a></li><li class=''><a href="../User_Manual/More_first_steps.html">More first steps</a></li><li class=''><a href="../User_Manual/System_updates.html">System updates</a></li><li class=''><a href="../User_Manual/Volume_Control_and_audio_quality.html">Volume Control and audio quality</a></li><li class=''><a href="../User_Manual/Stream_audio_to_volumio.html">Stream audio to volumio</a></li><li class=''><a href="../User_Manual/SSH.html">SSH</a></li><li class=''><a href="../User_Manual/Configure_MPD_Clients_for_albumart.html">Configure MPD Clients for albumart</a></li><li class=''><a href="../User_Manual/Sending_logs_for_troubleshooting.html">Sending logs for troubleshooting</a></li><li class=''><a href="../User_Manual/Other_Customizations.html">Other Customizations</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Development How To</a><ul class='nav nav-list'><li class=''><a href="../Development_How_To/Overview.html">Overview</a></li><li class=''><a href="../Development_How_To/System_Architecture.html">System Architecture</a></li><li class=''><a href="../Development_How_To/Set_up_development_environment_introduction.html">Set up development environment introduction</a></li><li class=''><a href="../Development_How_To/Set_up_development_environment_for_backend.html">Set up development environment for backend</a></li><li class=''><a href="../Development_How_To/Set_up_development_environment_for_UI.html">Set up development environment for UI</a></li><li class=''><a href="../Development_How_To/Set_up_development_environment_for_Volumio_images.html">Set up development environment for Volumio images</a></li><li class=''><a href="../Development_How_To/Updating_source_files.html">Updating source files</a></li><li class=''><a href="../Development_How_To/Debugging.html">Debugging</a></li><li class=''><a href="../Development_How_To/Helping_the_project.html">Helping the project</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>API</a><ul class='nav nav-list'><li class=''><a href="../API/API_Overview.html">API Overview</a></li><li class=''><a href="../API/WebSocket_APIs.html">WebSocket APIs</a></li><li class=''><a href="../API/UI_Configuration_Pages.html">UI Configuration Pages</a></li><li class=''><a href="../API/REST_API.html">REST API</a></li><li class=''><a href="../API/Command_Line_Client.html">Command Line Client</a></li></ul></li><li class='open has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Plugin System</a><ul class='nav nav-list'><li class=''><a href="../Plugin_System/Plugin_System_Overview.html">Plugin System Overview</a></li><li class=''><a href="../Plugin_System/Writing_A_Plugin.html">Writing A Plugin</a></li><li class=''><a href="../Plugin_System/Index.js.html">Index.js</a></li><li class=''><a href="../Plugin_System/UI_Configuration_Pages.html">UI Configuration Pages</a></li><li class=''><a href="../Plugin_System/Toast_Messages.html">Toast Messages</a></li><li class=''><a href="../Plugin_System/Logging.html">Logging</a></li><li class=''><a href="../Plugin_System/User_Modal.html">User Modal</a></li><li class='active'><a href="../Plugin_System/Music_Service_Plugin.html">Music Service Plugin</a></li><li class=''><a href="../Plugin_System/Custom_ALSA_Contributions.html">Custom ALSA Contributions</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>I2S DACs</a><ul class='nav nav-list'><li class=''><a href="../I2S_DACs/Adding_Compatibility_to_your_DAC.html">Adding Compatibility to your DAC</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Porting Guide</a><ul class='nav nav-list'><li class=''><a href="../Porting_Guide/Introduction.html">Introduction</a></li><li class=''><a href="../Porting_Guide/What_Is_Needed_To_Port_Successfully.html">What Is Needed To Port Successfully</a></li><li class=''><a href="../Porting_Guide/Preparing_The_Build_Environment.html">Preparing The Build Environment</a></li><li class=''><a href="../Porting_Guide/The_Process.html">The Process</a></li><li class=''><a href="../Porting_Guide/The_Platform_Folder.html">The Platform Folder</a></li><li class=''><a href="../Porting_Guide/Compiling_U-Boot.html">Compiling U-Boot</a></li><li class=''><a href="../Porting_Guide/Get_The_Kernel_Source.html">Get The Kernel Source</a></li><li class=''><a href="../Porting_Guide/Configure_Kernel_Options.html">Configure Kernel Options</a></li><li class=''><a href="../Porting_Guide/Compiling_The_Kernel.html">Compiling The Kernel</a></li><li class=''><a href="../Porting_Guide/Boot_Parameters.html">Boot Parameters</a></li><li class=''><a href="../Porting_Guide/Saving_Files_To_The_Platform_Folder.html">Saving Files To The Platform Folder</a></li><li class=''><a href="../Porting_Guide/A_Complete_Script.html">A Complete Script</a></li><li class=''><a href="../Porting_Guide/1_How_To_Build_A_Sparky.html">1 How To Build A Sparky</a></li><li class=''><a href="../Porting_Guide/Creating_the_image.html">Creating the image</a></li><li class=''><a href="../Porting_Guide/Creating_the_image_build_scripts (Part 1).html">Creating the image build scripts (Part 1)</a></li><li class=''><a href="../Porting_Guide/Creating_the_image_build_scripts (Part 2).html">Creating the image build scripts (Part 2)</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Plugins User Manuals</a><ul class='nav nav-list'><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>brutefir</a><ul class='nav nav-list'><li class=''><a href="../Plugins_User_Manuals/brutefir/Drc_with_Volumio.html">Drc with Volumio</a></li><li class=''><a href="../Plugins_User_Manuals/brutefir/Preparing_your_system.html">Preparing your system</a></li><li class=''><a href="../Plugins_User_Manuals/brutefir/Making_Measurment.html">Making Measurment</a></li><li class=''><a href="../Plugins_User_Manuals/brutefir/Making_filters.html">Making filters</a></li><li class=''><a href="../Plugins_User_Manuals/brutefir/Using_filters_in_Volumio.html">Using filters in Volumio</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>rotaryencoder2</a><ul class='nav nav-list'><li class=''><a href="../Plugins_User_Manuals/rotaryencoder2/Rotary_Encoder_II.html">Rotary Encoder II</a></li><li class=''><a href="../Plugins_User_Manuals/rotaryencoder2/Debouncing.html">Debouncing</a></li><li class=''><a href="../Plugins_User_Manuals/rotaryencoder2/Device_Tree_Overlays.html">Device Tree Overlays</a></li><li class=''><a href="../Plugins_User_Manuals/rotaryencoder2/Compatible_Encoders.html">Compatible Encoders</a></li><li class=''><a href="../Plugins_User_Manuals/rotaryencoder2/Appendix.html">Appendix</a></li></ul></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>Good to Knows</a><ul class='nav nav-list'><li class=''><a href="../Good_to_Knows/Markdown_Cheatsheet.html">Markdown Cheatsheet</a></li><li class=''><a href="../Good_to_Knows/Mounting_an_NFS_Share.html">Mounting an NFS Share</a></li><li class=''><a href="../Good_to_Knows/Contribute_to_this_Doc.html">Contribute to this Doc</a></li><li class=''><a href="../Good_to_Knows/Connection_Outside_LAN.html">Connection Outside LAN</a></li><li class=''><a href="../Good_to_Knows/Finding_Volumio.html">Finding Volumio</a></li></ul></li><li class=' has-children'><a href="#" class="aj-nav folder"><i class="arrow">&nbsp;</i>FAQs</a><ul class='nav nav-list'><li class=''><a href="../FAQs/General.html">General</a></li><li class=''><a href="../FAQs/Installation.html">Installation</a></li><li class=''><a href="../FAQs/Updating_and_Maintenance.html">Updating and Maintenance</a></li><li class=''><a href="../FAQs/Audio_Sources.html">Audio Sources</a></li><li class=''><a href="../FAQs/Audio_Output.html">Audio Output</a></li></ul></li></ul>

                <div class="sidebar-links">
                    
                        <!-- Links -->
                        <a href="https://volumio.org" target="_blank">Home</a><br><a href="https://volumio.org/get-started" target="_blank">Download</a><br><a href="https://volumio.org/forum" target="_blank">Forum</a><br><a href="https://github.com/volumio" target="_blank">GitHub Repo</a><br><a href="https://volumio.github.io/docs/Good_to_Knows/Contribute_to_this_Doc.html" target="_blank">Improve this documentation</a><br>
                        <div id="toggleCodeBlock">
                                                    <a id="toggleCodeBlockBtn" href="#" onclick="toggleCodeBlocks();">Show Code Blocks Inline</a><br>
                                                </div>

                        <!-- Twitter -->
                                                    <div class="twitter">
                                <hr/>
                                <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=volumio&amp;show_count=false"></iframe>
                            </div>
                        
                        <hr/>
                    
                </div>
            </div>
        </div>
        <div class="right-column  content-area col-sm-9">

            <div class="content-page">
                                    <div id="tipue_search_content" style="display:none"></div>
                
                <div class="doc_content">
                    <article>
            <div class="page-header">
            <h1>Music Service Plugin</h1>
        </div>
    
    <h2 id="page_Music_service_plugin">Music service plugin</h2>
<h3 id="page_Indexjs_aka_the_plugins_core_for_Music_Sources_Plugins">Index.js aka the plugin's core for Music Sources Plugins</h3>
<p>Music sources requires an extra bit of functions to be hooked properly into Volumio. Basically the need to expose their &quot;browsable&quot; structure of data, allow search and provide a translation for their displayed name on Music Sources. Missing any of those will result in a non working plugin, and possibly a broken Volumio.</p>
<p>Those are:</p>
<ul>
<li>addToBrowseSources</li>
<li>handleBrowseUri</li>
<li>explodeUri</li>
<li>search</li>
</ul>
<p>Optional functions are:</p>
<ul>
<li>getTrackInfo</li>
</ul>
<h3 id="page_Folders_and_Structures">Folders and Structures</h3>
<p>In your plugin you may want to show folders and songs. Volmuio knows several different types that offer different functionalities to the user.</p>
<p>Those types offer the user the opportunity to add it to its favorites or to a playlist by clicking on the burger mneu:</p>
<ul>
<li>folder</li>
<li>song</li>
<li>playlist</li>
</ul>
<p>Those types are simply for browsing without additional functionality - the burger menu isn't shown either.</p>
<ul>
<li>item-no-menu</li>
</ul>
<p>Use the type property on the object you are returning the the required and optional functions:</p>
<pre><code class="language-json">{
  &quot;title&quot;: &quot;Spotify result&quot;,
  &quot;icon&quot;: &quot;fa fa-music&quot;,
  &quot;availableListViews&quot;: [
    &quot;list&quot;, &quot;grid&quot;
  ],
  &quot;items&quot;: [
		{
			&quot;service&quot;: &quot;spop&quot;,
			&quot;type&quot;: &quot;song&quot;,
			&quot;title&quot;: &quot;Vienna&quot;,
			&quot;artist&quot;: &quot;Thom Sonny Green&quot;,
			&quot;album&quot;: &quot;High Anxiety&quot;,
			&quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
			&quot;uri&quot;: &quot;spotify:track:5cgSWdlxIelg5N9OjfkRow&quot;
		},
		{
			&quot;service&quot;: &quot;spop&quot;,
			&quot;type&quot;: &quot;song&quot;,
			&quot;title&quot;: &quot;40 Beers&quot;,
			&quot;artist&quot;: &quot;Thom Sonny Green&quot;,
			&quot;album&quot;: &quot;High Anxiety&quot;,
			&quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
			&quot;uri&quot;: &quot;spotify:track:2r6oZ0GBqJaCnqqR72yiFc&quot;
		}
  ]
}
</code></pre>
<p>if the request was to add songs of a playlist to queue then use following format to return by wrapping in a promise resolve value:-</p>
<pre><code class="language-json">[
		{
			&quot;service&quot;: &quot;googleplayservice&quot;,
			&quot;type&quot;: &quot;song&quot;,
			&quot;title&quot;: &quot;Space Song&quot;,
			&quot;artist&quot;: &quot;Beach House&quot;,
			&quot;album&quot;: &quot;Depression Cherry&quot;,
			&quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
			&quot;uri&quot;: &quot;googleplayservice:track:5cgSWdlxIelg5N9OjfkRow&quot;
		},
		{
			&quot;service&quot;: &quot;googleplayservice&quot;,
			&quot;type&quot;: &quot;song&quot;,
			&quot;title&quot;: &quot;40 Beers&quot;,
			&quot;artist&quot;: &quot;Thom Sonny Green&quot;,
			&quot;album&quot;: &quot;High Anxiety&quot;,
			&quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
			&quot;uri&quot;: &quot;googleplayservice:track:2r6oZ0GBqJaCnqqR72yiFc&quot;
		}
]
</code></pre>
<h3 id="page_Required_Functions">Required Functions</h3>
<h4 id="page_Add_to_Browse_sources">Add to Browse sources</h4>
<p>This functions adds the new music source to Main Browse Menu.
Rules to Follow:</p>
<ul>
<li>Invoke this function ONLY when the plugin starts properly, and if you're relying on a daemon only when successful connection has been established with the daemon and the service.</li>
<li>Every call to the <code>uri</code> specified here, will be handled by this plugin. Basically, when clicking &quot;Spotify&quot;, we'll handle the request in this plugin via the function and return the sub-categories available. Those will be handled by the <code>handleBrowseUri</code> function later on.</li>
</ul>
<pre><code class="language-javascript">ControllerSpop.prototype.addToBrowseSources = function () {
	var data = {name: 'Spotify', uri: 'spotify',plugin_type:'music_service',plugin_name:'spop'};
	this.commandRouter.volumioAddToBrowseSources(data);
};
</code></pre>
<h4 id="page_Handle_Browse_uri">Handle Browse uri</h4>
<p>This function is responsible to interpret the desired URI (basically the browse point requested) and return the available items. Some examples:</p>
<ul>
<li>Webradios browsing:</li>
</ul>
<pre><code class="language-javascript">ControllerWebradio.prototype.handleBrowseUri=function(curUri)
{
    var self=this;
    var response;

    if (curUri.startsWith('radio')) {
        if (curUri == 'radio')
            response = self.listRoot(curUri);
        else {
            if (curUri.startsWith('radio/myWebRadio')) {
                response = self.listMyWebRadio(curUri);
            }
            if (curUri.startsWith('radio/byGenre')) {
                if (curUri == 'radio/byGenre')
                    response = self.listRadioGenres(curUri);
                else
                    response = self.listRadioForGenres(curUri);
            }
            if (curUri.startsWith('radio/favourites')) {
                response = self.listRadioFavourites(curUri);
            }
             if (curUri==='radio/top500') {
                    response = self.listTop500Radios(curUri);
            }
             else if (curUri.startsWith('radio/byCountry')) {
                 if (curUri == 'radio/byCountry')
                     response = self.listRadioCountries(curUri);
                 else
                     response = self.listRadioForCountry(curUri);

             }
        }
    }

    return response;
}
</code></pre>
<ul>
<li>Music Library and playlist browsing:</li>
</ul>
<pre><code class="language-javascript">ControllerMpd.prototype.handleBrowseUri = function (curUri) {
    var self = this;

    var response;

    if (curUri.startsWith('music-library')) {
        response = self.lsInfo(curUri);
    }else if (curUri.startsWith('playlists')) {
        if (curUri == 'playlists')
            response = self.listPlaylists(curUri);
        else response = self.browsePlaylist(curUri);
    }

    return response;
};

</code></pre>
<ul>
<li>Spotify browsing</li>
</ul>
<pre><code class="language-javascript">ControllerSpop.prototype.handleBrowseUri=function(curUri)

{
	var self=this;

	//self.commandRouter.logger.info(curUri);
	var response;

	if (curUri.startsWith('spotify')) {
		if(curUri=='spotify')
		{
			response=libQ.resolve({
				navigation: {
					prev: {
						uri: 'spotify'
					},
					lists: [
                    {
                    &quot;title&quot;: &quot;Spotify Folders&quot;,
                    &quot;icon&quot;: &quot;fa fa-folder-open-o&quot;,
                    &quot;availableListViews&quot;: [&quot;list&quot;,&quot;grid&quot;],
                    &quot;items&quot;: [
						{
							service: 'spop',
							type: 'folder',
							title: 'My Playlists',
							artist: '',
							album: '',
							icon: 'fa fa-folder-open-o',
							uri: 'spotify/playlists'
						},
						{
							service: 'spop',
							type: 'folder',
							title: 'Featured Playlists',
							artist: '',
							album: '',
							icon: 'fa fa-folder-open-o',
							uri: 'spotify/featuredplaylists'
						},
						{
							service: 'spop',
							type: 'folder',
							title: 'What\'s New',
							artist: '',
							album: '',
							icon: 'fa fa-folder-open-o',
							uri: 'spotify/new'
						},
						{
							service: 'spop',
							type: 'folder',
							title: 'Genres &amp; Moods',
							artist: '',
							album: '',
							icon: 'fa fa-folder-open-o',
							uri: 'spotify/categories'
						}
					]
				}
                ]
                }
			});
		}
		else if(curUri.startsWith('spotify/playlists'))
		{
			if(curUri=='spotify/playlists')
				response=self.listPlaylists();
			else
			{
				response=self.listPlaylist(curUri);
			}
		}
		else if(curUri.startsWith('spotify/featuredplaylists'))
		{
			response=self.featuredPlaylists(curUri);
		}
		else if(curUri.startsWith('spotify/webplaylist'))
		{
			response=self.listWebPlaylist(curUri);
		}
		else if(curUri.startsWith('spotify/new'))
		{
			response=self.listWebNew(curUri);
		}
		else if(curUri.startsWith('spotify/categories'))
		{
			response=self.listWebCategories(curUri);
		}
		else if(curUri.startsWith('spotify/album'))
		{
			response=self.listWebAlbum(curUri);
		}
		else if(curUri.startsWith('spotify/category'))
		{
			response=self.listWebCategory(curUri);
		}
		else if(curUri.startsWith('spotify:artist:'))
		{
			response=self.listWebArtist(curUri);
		}
	}

	return response;
};
</code></pre>
<p>BEST PRACTICES:</p>
<ul>
<li>Hardcode all expected uris, and handle errors in case you receive an unknown one</li>
<li>Use separate functions for every uri tpye</li>
<li>Use promises where possible</li>
<li>If you use an external API service with API limits, cache where possible.</li>
<li>Navigation is nested, so make sure you provide the upper level (needed for going back while browsing)</li>
<li>You can display an icon by using <code>icon</code> and using a  <a href="http://fontawesome.io/icons/">font-awesome icon</a>
</li>
<li>You can display an image by using <code>albumart</code>, you can then pass a direct url or use the Albumart Server</li>
<li>The albumart API is: <code>/albumart?web=artist/album/large&amp;path=path</code> all encoded which becomes <code>/albumart?web=Alabama%20Shakes/Sound%20%26%20Color/large&amp;path=%2FUSB%2FALABAMA%20SHAKES%20S%20%26%20C</code>
</li>
<li>The <code>title</code> and <code>icon</code> attributes are used to divide sections with different content in it, like showing albums and songs for a particular artists. They become separators.</li>
<li>The <code>availableListViews</code> attribute is used to indicate the visualizations options available for this particular list of items. Generally folders, albums and artists have both list and grid views available, while tracks and genres are visualized only in list mode.</li>
</ul>
<p>GENERIC OUTPUT EXAMPLE:</p>
<pre><code class="language-json">{
  &quot;navigation&quot;: {
    &quot;lists&quot;: [
      {
        &quot;title&quot;: &quot;Artists&quot;,
        &quot;icon&quot;: &quot;fa icon&quot;,
        &quot;availableListViews&quot;: [
          &quot;list&quot;,
          &quot;grid&quot;
        ],
        &quot;items&quot;: [
          {
            &quot;service&quot;: &quot;mpd&quot;,
            &quot;type&quot;: &quot;song&quot;,
            &quot;title&quot;: &quot;Led Zeppelin&quot;,
            &quot;icon&quot;: &quot;fa fa-music&quot;,
            &quot;uri&quot;: &quot;search://artist/Led Zeppelin&quot;
          }
        ]
      },
      {
        &quot;title&quot;: &quot;Webradios&quot;,
        &quot;icon&quot;: &quot;&quot;,
        &quot;availableListViews&quot;: [
          &quot;list&quot;
        ],
        &quot;items&quot;: [
          {
            &quot;service&quot;: &quot;webradio&quot;,
            &quot;type&quot;: &quot;webradio&quot;,
            &quot;title&quot;: &quot;ledjam&quot;,
            &quot;artist&quot;: &quot;&quot;,
            &quot;album&quot;: &quot;&quot;,
            &quot;icon&quot;: &quot;fa fa-microphone&quot;,
            &quot;uri&quot;: &quot;http://yp.shoutcast.com/sbin/tunein-station.m3u?id=492072&quot;
          },
          {
            &quot;service&quot;: &quot;webradio&quot;,
            &quot;type&quot;: &quot;webradio&quot;,
            &quot;title&quot;: &quot;NAXI 80-e RADIO (NAXI,Belgrade,Serbia, NAXI,Beograd,Srbija) - 128k&quot;,
            &quot;artist&quot;: &quot;&quot;,
            &quot;album&quot;: &quot;&quot;,
            &quot;icon&quot;: &quot;fa fa-microphone&quot;,
            &quot;uri&quot;: &quot;http://yp.shoutcast.com/sbin/tunein-station.m3u?id=68544&quot;
          }
        ]
      }
    ],
    &quot;prev&quot;: {
      &quot;uri&quot;: &quot;/&quot;
    }
  }
}
</code></pre>
<p>EXPECTED RESULTS EXAMPLES:</p>
<ul>
<li>Local folders</li>
</ul>
<pre><code class="language-json">{
  &quot;navigation&quot;: {
    &quot;prev&quot;: {
      &quot;uri&quot;: &quot;music-library&quot;
    },
    &quot;lists&quot;: [
      {
      &quot;availableListViews&quot;: [&quot;list&quot;,&quot;grid&quot;],
      &quot;items&quot;: [
      {
        &quot;type&quot;: &quot;folder&quot;,
        &quot;title&quot;: &quot;Calibro 35 (2008)&quot;,
        &quot;icon&quot;: &quot;fa fa-folder-open-o&quot;,
        &quot;uri&quot;: &quot;music-library/USB/Calibro 35 (2008)&quot;
      },
      {
        &quot;type&quot;: &quot;folder&quot;,
        &quot;title&quot;: &quot;In Sight&quot;,
        &quot;icon&quot;: &quot;fa fa-folder-open-o&quot;,
        &quot;uri&quot;: &quot;music-library/USB/In Sight&quot;
      }
    ]
    }
    ]
  }
}
</code></pre>
<ul>
<li>Local files</li>
</ul>
<pre><code class="language-json">{
  &quot;navigation&quot;: {
    &quot;prev&quot;: {
      &quot;uri&quot;: &quot;music-library/USB&quot;
    },
    &quot;lists&quot;: [
      {
      &quot;availableListViews&quot;: [&quot;list&quot;],
      &quot;items&quot;: [
      {
        &quot;service&quot;: &quot;mpd&quot;,
        &quot;type&quot;: &quot;song&quot;,
        &quot;title&quot;: &quot;Sound &amp; Color&quot;,
        &quot;artist&quot;: &quot;Alabama Shakes&quot;,
        &quot;album&quot;: &quot;Sound &amp; Color&quot;,
        &quot;icon&quot;: &quot;fa fa-music&quot;,
        &quot;uri&quot;: &quot;music-library/USB/ALABAMA SHAKES S &amp; C/01 Sound &amp; Color.mp3&quot;
      },
      {
        &quot;service&quot;: &quot;mpd&quot;,
        &quot;type&quot;: &quot;song&quot;,
        &quot;title&quot;: &quot;Don't Wanna Fight&quot;,
        &quot;artist&quot;: &quot;Alabama Shakes&quot;,
        &quot;album&quot;: &quot;Sound &amp; Color&quot;,
        &quot;icon&quot;: &quot;fa fa-music&quot;,
        &quot;uri&quot;: &quot;music-library/USB/ALABAMA SHAKES S &amp; C/02 Don't Wanna Fight.mp3&quot;
      }
    ]
    }
    ]
  }
}
</code></pre>
<ul>
<li>Webradios</li>
</ul>
<pre><code class="language-json">{
  &quot;navigation&quot;: {
    &quot;prev&quot;: {
      &quot;uri&quot;: &quot;radio/byGenre&quot;
    },
    &quot;lists&quot;: [
    {
      &quot;availableListViews&quot;: [&quot;list&quot;],
      &quot;items&quot;: [
      {
        &quot;service&quot;: &quot;webradio&quot;,
        &quot;type&quot;: &quot;webradio&quot;,
        &quot;title&quot;: &quot;Oldies FM&quot;,
        &quot;artist&quot;: &quot;&quot;,
        &quot;album&quot;: &quot;&quot;,
        &quot;icon&quot;: &quot;fa fa-microphone&quot;,
        &quot;uri&quot;: &quot;http://yp.shoutcast.com/sbin/tunein-station.m3u?id=728640&quot;
      },
      {
        &quot;service&quot;: &quot;webradio&quot;,
        &quot;type&quot;: &quot;webradio&quot;,
        &quot;title&quot;: &quot;San Francisco's 70's HITS!&quot;,
        &quot;artist&quot;: &quot;&quot;,
        &quot;album&quot;: &quot;&quot;,
        &quot;icon&quot;: &quot;fa fa-microphone&quot;,
        &quot;uri&quot;: &quot;http://yp.shoutcast.com/sbin/tunein-station.m3u?id=1087995&quot;
      }
    ]
    }
    ]
  }
}
</code></pre>
<ul>
<li>Spotify Categories (similar to local folders)</li>
</ul>
<pre><code class="language-json">{
  &quot;navigation&quot;: {
    &quot;prev&quot;: {
      &quot;uri&quot;: &quot;spotify&quot;
    },
    &quot;lists&quot;: [
    {
      &quot;availableListViews&quot;: [&quot;list&quot;,&quot;grid&quot;],
      &quot;items&quot;: [
      {
        &quot;service&quot;: &quot;spop&quot;,
        &quot;type&quot;: &quot;folder&quot;,
        &quot;title&quot;: &quot;My Playlists&quot;,
        &quot;artist&quot;: &quot;&quot;,
        &quot;album&quot;: &quot;&quot;,
        &quot;icon&quot;: &quot;fa fa-folder-open-o&quot;,
        &quot;uri&quot;: &quot;spotify/playlists&quot;
      },
      {
        &quot;service&quot;: &quot;spop&quot;,
        &quot;type&quot;: &quot;folder&quot;,
        &quot;title&quot;: &quot;Featured Playlists&quot;,
        &quot;artist&quot;: &quot;&quot;,
        &quot;album&quot;: &quot;&quot;,
        &quot;icon&quot;: &quot;fa fa-folder-open-o&quot;,
        &quot;uri&quot;: &quot;spotify/featuredplaylists&quot;
      }
    ]
    }
    ]
  }
}
</code></pre>
<ul>
<li>Spotify Songs (streaming plugins)</li>
</ul>
<pre><code class="language-json">{
  &quot;navigation&quot;: {
    &quot;prev&quot;: {
      &quot;uri&quot;: &quot;spotify&quot;
    },
    &quot;lists&quot;: [
    {
      &quot;availableListViews&quot;: [&quot;list&quot;],
      &quot;items&quot;: [
      {
        &quot;service&quot;: &quot;spop&quot;,
        &quot;type&quot;: &quot;song&quot;,
        &quot;title&quot;: &quot;Vienna&quot;,
        &quot;artist&quot;: &quot;Thom Sonny Green&quot;,
        &quot;album&quot;: &quot;High Anxiety&quot;,
        &quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
        &quot;uri&quot;: &quot;spotify:track:5cgSWdlxIelg5N9OjfkRow&quot;
      },
      {
        &quot;service&quot;: &quot;spop&quot;,
        &quot;type&quot;: &quot;song&quot;,
        &quot;title&quot;: &quot;40 Beers&quot;,
        &quot;artist&quot;: &quot;Thom Sonny Green&quot;,
        &quot;album&quot;: &quot;High Anxiety&quot;,
        &quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
        &quot;uri&quot;: &quot;spotify:track:2r6oZ0GBqJaCnqqR72yiFc&quot;
      }
    ]
    }
    ]
  }
}

</code></pre>
<h4 id="page_Explode_uri">Explode uri</h4>
<p>This function takes care of retrieving all informations related to a particular URI, it's needed both by queue and state machine. Some examples:</p>
<ul>
<li>Local files (MPD)</li>
</ul>
<pre><code class="language-javascript">ControllerMpd.prototype.explodeUri = function(uri) {
    var self = this;

    var defer=libQ.defer();

    var items = [];
    var cmd = libMpd.cmd;

    if(uri.startsWith('search://'))
    {
        //exploding search
        var splitted=uri.split('/');

        var argument=splitted[2];
        var value=splitted[3];

        if(argument==='artist')
        {
            var commandArtist = 'search artist '+' &quot;' + value + '&quot;';

            self.mpdReady.then(function () {
                self.clientMpd.sendCommand(cmd(commandArtist, []), function (err, msg) {
                    var subList=[];

                    if (msg) {
                        var lines = msg.split('\n');
                        for (var i = 0; i &lt; lines.length; i++) {
                            var line = lines[i];

                            if (line.startsWith('file:')) {
                                var path = line.slice(5).trimLeft();
                                var name = path.split('/');
                                var count = name.length;

                                var artist = self.searchFor(lines, i + 1, 'Artist:');
                                var album = self.searchFor(lines, i + 1, 'Album:');
                                var title = self.searchFor(lines, i + 1, 'Title:');
                                var time = parseInt(self.searchFor(lines, i + 1, 'Time:'));

                                if (title) {
                                    title = title;
                                } else {
                                    title = name;
                                }

                                items.push({
                                    uri: 'music-library/'+path,
                                    service: 'mpd',
                                    name: title,
                                    artist: artist,
                                    album: album,
                                    type: 'track',
                                    tracknumber: 0,
                                    albumart: self.getAlbumArt({artist:artist,album: album},uri),
                                    duration: time,
                                    trackType: 'mp3'
                                });
                            }

                        }

                        defer.resolve(items);
                    }
                    else if(err)  defer.reject(new Error('Artist:' +err));
                    else defer.resolve(items);
                });
            });
        }
        else if(argument==='album')
        {
            var commandAlbum = 'search album '+' &quot;' + value + '&quot;';

            self.mpdReady.then(function () {
                self.clientMpd.sendCommand(cmd(commandAlbum, []), function (err, msg) {
                    var subList=[];

                    if (msg) {

                        var lines = msg.split('\n');
                        for (var i = 0; i &lt; lines.length; i++) {
							var line = lines[i];

                            if (line.startsWith('file:')) {
                                var path = line.slice(5).trimLeft();
                                var name = path.split('/');
                                var count = name.length;

                                var artist = self.searchFor(lines, i + 1, 'Artist:');
                                var album = self.searchFor(lines, i + 1, 'Album:');
                                var title = self.searchFor(lines, i + 1, 'Title:');
                                var time = parseInt(self.searchFor(lines, i + 1, 'Time:'));

                                if (title) {
                                    title = title;
                                } else {
                                    title = name;
                                }

                                items.push({
                                    uri: 'music-library/' + path,
                                    service: 'mpd',
                                    name: title,
                                    artist: artist,
                                    album: album,
                                    type: 'track',
                                    tracknumber: 0,
                                    albumart: self.getAlbumArt({artist: artist, album: album}, uri),
                                    duration: time,
                                    trackType: 'mp3'
                                });
                            }
                        }
                        defer.resolve(items);
                    }
                    else if(err)  defer.reject(new Error('Artist:' +err));
                    else defer.resolve(items);
                });
            });
        }
        else defer.reject(new Error());
    }
    else {
        var uriPath='/mnt/'+self.sanitizeUri(uri);
        self.commandRouter.logger.info('----------------------------'+uriPath);
        var uris=self.scanFolder(uriPath);
        var response=[];

        libQ.all(uris)
            .then(function(result)
            {
                for(var j in result)
                {

                    self.commandRouter.logger.info(&quot;-----&gt;&gt;&gt;&gt;&gt; &quot;+JSON.stringify(result[j]));

                    if(result!==undefined &amp;&amp; result[j].uri!==undefined)
                    {
                        response.push({
                            uri: self.fromPathToUri(result[j].uri),
                            service: 'mpd',
                            name: result[j].name,
                            artist: result[j].artist,
                            album: result[j].album,
                            type: 'track',
                            tracknumber: result[j].tracknumber,
                            albumart: result[j].albumart,
                            duration: result[j].duration,
                            samplerate: result[j].samplerate,
                            bitdepth: result[j].bitdepth,
                            trackType: result[j].trackType
                        });
                    }

                }

                defer.resolve(response);
            }).fail(function(err)
        {
            self.commandRouter.logger.info(&quot;explodeURI: ERROR &quot;+err);
            defer.resolve([]);
        });
    }

    return defer.promise;
};

</code></pre>
<ul>
<li>Webradio</li>
</ul>
<pre><code class="language-javascript">ControllerWebradio.prototype.explodeUri = function(uri) {
    var self = this;

    var defer=libQ.defer();

    defer.resolve({
        uri: uri,
        service: 'webradio',
        name: uri,
        type: 'track'
    });

    return defer.promise;
};
</code></pre>
<h4 id="page_Search">Search</h4>
<p>Every Music Service should provide a search function, but that's not mandatory. A typical search function MUST use promises and return objects formatted exactly like the above browse results. This is what a search backbone look like, where all search results are pushed into a list array and then resolved. Remember to divide search results (like artist, folders etc) with the APIs detailed above (title and icon) and to respect visualization types.</p>
<pre><code class="language-javascript">ControllerSpop.prototype.search = function (query) {

	var self=this;

	var defer=libQ.defer();

  defer.resolve(list);


  			}, function (err) {
  				self.logger.info('An error occurred while searching ' + err);
  			});
  		});

  	return defer.promise;
</code></pre>
<p>As result the following structure is expected:</p>
<pre><code class="language-json">{
  &quot;title&quot;: &quot;Spotify result&quot;,
  &quot;icon&quot;: &quot;fa fa-music&quot;,
  &quot;availableListViews&quot;: [
    &quot;list&quot;, &quot;grid&quot;
  ],
  &quot;items&quot;: [
		{
			&quot;service&quot;: &quot;spop&quot;,
			&quot;type&quot;: &quot;song&quot;,
			&quot;title&quot;: &quot;Vienna&quot;,
			&quot;artist&quot;: &quot;Thom Sonny Green&quot;,
			&quot;album&quot;: &quot;High Anxiety&quot;,
			&quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
			&quot;uri&quot;: &quot;spotify:track:5cgSWdlxIelg5N9OjfkRow&quot;
		},
		{
			&quot;service&quot;: &quot;spop&quot;,
			&quot;type&quot;: &quot;song&quot;,
			&quot;title&quot;: &quot;40 Beers&quot;,
			&quot;artist&quot;: &quot;Thom Sonny Green&quot;,
			&quot;album&quot;: &quot;High Anxiety&quot;,
			&quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
			&quot;uri&quot;: &quot;spotify:track:2r6oZ0GBqJaCnqqR72yiFc&quot;
		}
  ]
}
</code></pre>
<h3 id="page_Optional_Functions">Optional Functions</h3>
<h4 id="page_Get_Track_Info">Get Track Info</h4>
<p>This method is called by volumio when the user adds e.g. a song to a playlist or to the favorites.
You have to return a promise that will resolve as soon as you have collected all details about the URI that is passed in as parameter.</p>
<p>The expected format is an array containing the following information - the more you provide, the more the UI can visualize (e.g. if you are missing an albumart you can also use the icon property).</p>
<pre><code class="language-json">[
  {
    &quot;service&quot;: &quot;spop&quot;,
    &quot;type&quot;: &quot;song&quot;,
    &quot;title&quot;: &quot;Vienna&quot;,
    &quot;artist&quot;: &quot;Thom Sonny Green&quot;,
    &quot;album&quot;: &quot;High Anxiety&quot;,
    &quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
    &quot;uri&quot;: &quot;spotify:track:5cgSWdlxIelg5N9OjfkRow&quot;
  },
  {
    &quot;service&quot;: &quot;spop&quot;,
    &quot;type&quot;: &quot;song&quot;,
    &quot;title&quot;: &quot;40 Beers&quot;,
    &quot;artist&quot;: &quot;Thom Sonny Green&quot;,
    &quot;album&quot;: &quot;High Anxiety&quot;,
    &quot;albumart&quot;: &quot;https://i.scdn.co/image/dac9ef993de0a5758cc6e655080306d40814edc9&quot;,
    &quot;uri&quot;: &quot;spotify:track:2r6oZ0GBqJaCnqqR72yiFc&quot;
  }
]
</code></pre>
<p>The example code is shown from the YouTube plugin:</p>
<pre><code class="language-javascript">Youtube.prototype.getTrackInfo = function (uri) {
  var self = this;
  var deferred = libQ.defer();

  if (uri.startsWith('youtube')) {
    var uriParts = uri.split('/');
    var id = uriParts.pop();
    var kind = uriParts.pop();

    switch (kind) {
      case 'playlist':
        self.getPlaylistItems(id).then(function (playlistItems) {
          if (playlistItems.navigation.lists.length &gt; 0
            &amp;&amp; playlistItems.navigation.lists[0].items.length &gt; 0) {
            console.log(playlistItems.navigation.lists[0].items)
            deferred.resolve(playlistItems.navigation.lists[0].items);
          } else {
            deferred.reject(new Error('Failed to load playlist info.'));
          }
        });
        break;
      case 'video':
        self.getVideo(id).then(function (videoItems) {
          console.log(JSON.stringify(videoItems));
          if (videoItems.items.length &gt; 0) {
            deferred.resolve(videoItems.items);
          } else {
            deferred.reject(new Error('Failed to load video info.'));
          }
        });
        break;
      default:
        self.logger.error(&quot;Youtube::getTrackInfo unknown uri kind: &quot; + kind);
        deferred.reject(new Error('Unknown uri kind ' + kind));
        break;
    }

  } else {
    self.logger.info(&quot;Youtube::getTrackInfo unknown uri: &quot; + uri);
    deferred.reject(new Error('Unknown uri ' + uri));
  }

  return deferred.promise;
}
</code></pre>

        <nav>
        <ul class="pager">
            <li><a href="../Plugin_System/User_Modal.html">Previous</a></li>            <li><a href="../Plugin_System/Custom_ALSA_Contributions.html">Next</a></li>        </ul>
    </nav>
    </article>

                </div>
            </div>
        </div>
    </div>
</div>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46374275-1', '');
    ga('send', 'pageview');
</script>

    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch_set.js"></script>
        <script type="text/javascript" src="../tipuesearch/tipuesearch.min.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(document).ready(function() {
                $('#tipue_search_input').tipuesearch({
                    'show': 10,
                    'mode': 'json',
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
